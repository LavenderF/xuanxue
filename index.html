<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ˜“ç»æ‘‡å¦æ¨¡æ‹Ÿå™¨</title>
  <style>
    body {
      font-family: "å®‹ä½“", serif;
      background: #fefaf0;
      text-align: center;
      padding: 20px;
      color: #333;
    }
    .yao {
      font-size: 26px;
      margin: 6px;
    }
    .yang { color: #b54800; }
    .yin { color: #000; }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 20px auto;
      cursor: pointer;
      background-color: #fff7e0;
      border: 1px solid #ccc;
    }
    .svg-box {
      display: inline-block;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>æ˜“ç»ä¸‰æšé“œé’±æ‘‡å¦æ¨¡æ‹Ÿå™¨</h1>
  <button onclick="shakeGua()">ğŸ”® æ‘‡å¦</button>
  <div id="gua"></div>

  <script>
    const baguaNames = ["å¤", "è‰®", "å", "å·½", "éœ‡", "ç¦»", "å…‘", "ä¹¾"];
    const gua64Names = [
      "å¤ä¸ºåœ°","åœ°å±±è°¦","åœ°æ°´å¸ˆ","åœ°é£å‡","åœ°é›·å¤","åœ°ç«æ˜å¤·","åœ°æ³½ä¸´","åœ°å¤©æ³°",
      "å±±åœ°å‰¥","è‰®ä¸ºå±±","å±±æ°´è’™","å±±é£è›Š","å±±é›·é¢","å±±ç«è´²","å±±æ³½æŸ","å±±å¤©å¤§ç•œ",
      "æ°´åœ°æ¯”","æ°´å±±è¹‡","åä¸ºæ°´","æ°´é£äº•","æ°´é›·å±¯","æ°´ç«æ—¢æµ","æ°´æ³½èŠ‚","æ°´å¤©éœ€",
      "é£åœ°è§‚","é£å±±æ¸","é£æ°´æ¶£","å·½ä¸ºé£","é£é›·ç›Š","é£ç«å®¶äºº","é£æ³½ä¸­å­š","é£å¤©å°ç•œ",
      "é›·åœ°è±«","é›·å±±å°è¿‡","é›·æ°´è§£","é›·é£æ’","éœ‡ä¸ºé›·","é›·ç«ä¸°","é›·æ³½å½’å¦¹","é›·å¤©å¤§å£®",
      "ç«åœ°æ™‹","ç«å±±æ—…","ç«æ°´æœªæµ","ç«é£é¼","ç«é›·å™¬å—‘","ç¦»ä¸ºç«","ç«æ³½ç½","ç«å¤©å¤§æœ‰",
      "æ³½åœ°èƒ","æ³½å±±å’¸","æ³½æ°´å›°","æ³½é£å¤§è¿‡","æ³½é›·éš","æ³½ç«é©","å…‘ä¸ºæ³½","æ³½å¤©å¤¬",
      "å¤©åœ°å¦","å¤©å±±é","å¤©æ°´è®¼","å¤©é£å§¤","å¤©é›·æ— å¦„","å¤©ç«åŒäºº","å¤©æ³½å±¥","ä¹¾ä¸ºå¤©"
    ];

    const guaExplanations = {
      "ä¹¾ä¸ºå¤©": {
        guaci: "å…ƒï¼Œäº¨ï¼Œåˆ©ï¼Œè´ã€‚",
        yaoci: [
          "åˆä¹ï¼šæ½œé¾™ï¼Œå‹¿ç”¨ã€‚",
          "ä¹äºŒï¼šè§é¾™åœ¨ç”°ï¼Œåˆ©è§å¤§äººã€‚",
          "ä¹ä¸‰ï¼šå›å­ç»ˆæ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥ï¼Œå‰æ— å’ã€‚",
          "ä¹å››ï¼šæˆ–è·ƒåœ¨æ¸Šï¼Œæ— å’ã€‚",
          "ä¹äº”ï¼šé£é¾™åœ¨å¤©ï¼Œåˆ©è§å¤§äººã€‚",
          "ä¸Šä¹ï¼šäº¢é¾™æœ‰æ‚”ã€‚"
        ]
      },
      "å¤ä¸ºåœ°": {
        guaci: "å…ƒï¼Œäº¨ï¼Œåˆ©ï¼Œç‰é©¬ä¹‹è´ã€‚",
        yaoci: [
          "åˆå…­ï¼šå±¥éœœï¼Œåšå†°è‡³ã€‚",
          "å…­äºŒï¼šç›´æ–¹å¤§ï¼Œä¸ä¹ æ— ä¸åˆ©ã€‚",
          "å…­ä¸‰ï¼šå«ç« å¯è´ã€‚æˆ–ä»ç‹äº‹ï¼Œæ— æˆæœ‰ç»ˆã€‚",
          "å…­å››ï¼šæ‹¬å›Šï¼Œæ— å’æ— èª‰ã€‚",
          "å…­äº”ï¼šé»„è£³ï¼Œå…ƒå‰ã€‚",
          "ä¸Šå…­ï¼šé¾™æˆ˜äºé‡ï¼Œå…¶è¡€ç„é»„ã€‚"
        ]
      }
    };

    function tossThreeCoins() {
      let heads = 0;
      for (let i = 0; i < 3; i++) {
        if (Math.random() < 0.5) heads++;
      }
      if (heads === 3) return 9;
      if (heads === 2) return 7;
      if (heads === 1) return 8;
      return 6;
    }

    function yaoSymbol(val) {
      const isYang = (val === 7 || val === 9);
      const isOld = (val === 6 || val === 9);
      const symbol = isYang ? "âšŠâšŠâšŠ" : "âš‹âš‹âš‹";
      return `<span class="${isYang ? 'yang' : 'yin'}">${symbol}${isOld ? "ï¼ˆå˜çˆ»ï¼‰" : ""}</span>`;
    }

    function yaoToBinary(val) {
      return (val === 7 || val === 9) ? 1 : 0;
    }

    function getGuaName(yaoList) {
      let lower = yaoList.slice(3).map(yaoToBinary).join('');
      let upper = yaoList.slice(0, 3).map(yaoToBinary).join('');
      let lowerIndex = parseInt(lower, 2);
      let upperIndex = parseInt(upper, 2);
      let guaIndex = upperIndex * 8 + lowerIndex;
      return {
        name: gua64Names[guaIndex],
        upper: baguaNames[upperIndex],
        lower: baguaNames[lowerIndex]
      };
    }

    function getTransformedGua(yaoList) {
      return yaoList.map(val => (val === 6 ? 7 : val === 9 ? 8 : val));
    }

    function drawBaguaSVG(threeYao) {
      let svg = `<svg width="60" height="100">`;
      for (let i = 0; i < 3; i++) {
        const y = 20 + i * 25;
        const val = threeYao[i];
        const isYang = (val === 7 || val === 9);
        if (isYang) {
          svg += `<line x1="10" y1="${y}" x2="50" y2="${y}" stroke="black" stroke-width="6"/>`;
        } else {
          svg += `<line x1="10" y1="${y}" x2="25" y2="${y}" stroke="black" stroke-width="6"/>
                  <line x1="35" y1="${y}" x2="50" y2="${y}" stroke="black" stroke-width="6"/>`;
        }
      }
      svg += `</svg>`;
      return svg;
    }

    function shakeGua() {
      const guaDiv = document.getElementById("gua");
      guaDiv.innerHTML = "";
      const yaoList = [];

      for (let i = 0; i < 6; i++) yaoList.unshift(tossThreeCoins());

      yaoList.forEach((val, i) => {
        guaDiv.innerHTML += `<div class="yao">ç¬¬ ${6 - i} çˆ»ï¼š${yaoSymbol(val)}</div>`;
      });

      const guaInfo = getGuaName(yaoList);
      guaDiv.innerHTML += `<hr><div><strong>æœ¬å¦ï¼š</strong>${guaInfo.name}ï¼ˆä¸Šå¦ï¼š${guaInfo.upper}ï¼Œä¸‹å¦ï¼š${guaInfo.lower}ï¼‰</div>`;
      guaDiv.innerHTML += `<div class="svg-box">${drawBaguaSVG(yaoList.slice(0,3))}<br>${guaInfo.upper}</div>`;
      guaDiv.innerHTML += `<div class="svg-box">${drawBaguaSVG(yaoList.slice(3))}<br>${guaInfo.lower}</div>`;

      const zhiList = getTransformedGua(yaoList);
      const zhiInfo = getGuaName(zhiList);
      guaDiv.innerHTML += `<hr><div><strong>ä¹‹å¦ï¼š</strong>${zhiInfo.name}ï¼ˆä¸Šå¦ï¼š${zhiInfo.upper}ï¼Œä¸‹å¦ï¼š${zhiInfo.lower}ï¼‰</div>`;
      guaDiv.innerHTML += `<div class="svg-box">${drawBaguaSVG(zhiList.slice(0,3))}<br>${zhiInfo.upper}</div>`;
      guaDiv.innerHTML += `<div class="svg-box">${drawBaguaSVG(zhiList.slice(3))}<br>${zhiInfo.lower}</div>`;

      if (guaExplanations[guaInfo.name]) {
        const { guaci, yaoci } = guaExplanations[guaInfo.name];
        guaDiv.innerHTML += `<hr><div><strong>å¦è¾ï¼š</strong>${guaci}</div><br>`;
        yaoList.forEach((val, idx) => {
          guaDiv.innerHTML += `<div>ç¬¬${idx + 1}çˆ»è¾ï¼š${yaoci[idx]}</div>`;
        });
      } else {
        guaDiv.innerHTML += `<div>ï¼ˆæœªæ‰¾åˆ°æ­¤å¦çš„è¯¦ç»†è§£é‡Šï¼‰</div>`;
      }
    }
  </script>
</body>
</html>
